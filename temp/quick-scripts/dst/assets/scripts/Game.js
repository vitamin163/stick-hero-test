
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Game.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '060eccP2o9PwYEnb4pvEUjk', 'Game');
// scripts/Game.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    newGroundPrefab: {
      "default": null,
      type: cc.Prefab
    },
    redPointPrefab: {
      "default": null,
      type: cc.Prefab
    },
    stickPrefab: {
      "default": null,
      type: cc.Prefab
    },
    ground: {
      "default": null,
      type: cc.Node
    },
    player: {
      "default": null,
      type: cc.Node
    },
    scoreDisplay: {
      "default": null,
      type: cc.Label
    },
    playerDestination: 'none',
    isMoving: false,
    touchStart: false,
    touchEnd: false,
    collision: false,
    stick: null,
    newGround: null,
    beyond: -500,
    startPosition: -300
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    this.stick = this.spawnStick();
    this.newGround = this.spawnNewGround();
    this.player.getComponent('Player').game = this;
    this.score = 0;
  },
  onEnable: function onEnable() {
    this.node.once(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);
    this.node.once(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);
  },
  onTouchStart: function onTouchStart() {
    this.touchStart = true;
    this.touchEnd = false;
  },
  onTouchEnd: function onTouchEnd() {
    this.touchStart = false;
    this.touchEnd = true;

    if (this.calculateCollision()) {
      this.successAction();
    } else {
      this.failAction();
    }
  },
  setScore: function setScore() {
    this.scoreDisplay.string = 'Score: ' + this.score;
  },
  calculateCollision: function calculateCollision() {
    var startCollisionPoint = this.newGround.x - this.newGround.width / 2;
    var endCollisionPoint = this.newGround.x + this.newGround.width / 2;
    var startCollisionRedPoint = this.newGround.x - this.redPointPrefab.data.width / 2;
    var endCollisionRedPoint = this.newGround.x + this.redPointPrefab.data.width / 2;
    var destination = this.stick.x + this.stick.height;
    var isCollision = destination >= startCollisionPoint && destination <= endCollisionPoint;
    var isPerfect = destination >= startCollisionRedPoint && destination <= endCollisionRedPoint;

    if (isCollision && !isPerfect) {
      this.score += 1;
    } else if (isPerfect) {
      this.score += 2;
    }

    return isCollision;
  },
  getTime: function getTime(distance) {
    var speed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;
    return distance / speed;
  },
  successAction: function successAction() {
    var _this = this;

    var playerMoveTime = this.getTime(this.playerDestination - this.player.x);
    var stickComebackTime = this.getTime(this.newGround.x - this.stick.x + this.newGround.width / 2);
    var comebackTime = this.getTime(this.newGround.x - this.startPosition);
    cc.tween(this.stick).delay(0.3).to(0.4, {
      angle: -90
    }).call(function () {
      cc.tween(_this.player).to(playerMoveTime, {
        position: cc.v2(_this.playerDestination, _this.stick.y)
      }).call(function () {
        cc.tween(_this.newGround).to(comebackTime, {
          position: cc.v2(_this.startPosition, _this.ground.y)
        }).start();
      }).call(function () {
        cc.tween(_this.player).to(comebackTime, {
          position: cc.v2(_this.startPosition + _this.newGround.width / 2 - 20, _this.stick.y)
        }).start();
      }).call(function () {
        cc.tween(_this.stick).to(stickComebackTime, {
          position: cc.v2(_this.stick.x - (_this.newGround.x - _this.stick.x + _this.newGround.width / 2), _this.stick.y)
        }).start();
      }).call(function () {
        cc.tween(_this.ground).to(comebackTime, {
          position: cc.v2(-800, _this.ground.y)
        }).call(function () {
          return _this.ground.destroy();
        }).call(function () {
          return _this.ground = _this.newGround;
        }).call(function () {
          _this.stick.active = false;
          _this.stick = _this.spawnStick();
          _this.newGround = _this.spawnNewGround();

          _this.node.once(cc.Node.EventType.TOUCH_START, _this.onTouchStart, _this);

          _this.node.once(cc.Node.EventType.TOUCH_END, _this.onTouchEnd, _this);
        }).start();
      }).start();
    }).call(function () {
      return _this.setScore();
    }).start().start();
  },
  failAction: function failAction() {
    var _this2 = this;

    var playerMoveTime = this.getTime(this.stick.height);
    cc.tween(this.stick).delay(0.3).to(0.4, {
      angle: -90
    }).call(function () {
      cc.tween(_this2.player).to(playerMoveTime, {
        position: cc.v2(_this2.player.x + _this2.stick.height, _this2.stick.y)
      }).call(function () {
        cc.tween(_this2.stick).to(0.4, {
          angle: -180
        }).start();
      }).call(function () {
        cc.tween(_this2.player).by(0.3, {
          position: cc.v2(0, -350)
        }).delay(1).call(function () {
          return cc.director.loadScene('game');
        }).start();
      }).start();
    }).start();
  },
  randomInteger: function randomInteger(min, max) {
    var rand = min + Math.random() * (max + 1 - min);
    return Math.floor(rand);
  },
  spawnRedPoint: function spawnRedPoint() {
    return cc.instantiate(this.redPointPrefab);
  },
  spawnStick: function spawnStick() {
    var newStick = cc.instantiate(this.stickPrefab);
    this.node.addChild(newStick);
    newStick.anchorY = 0;
    newStick.y = this.ground.y + this.ground.height / 2;
    newStick.x = this.startPosition + this.ground.width / 2;
    newStick.getComponent('Stick').game = this;
    return newStick;
  },
  spawnNewGround: function spawnNewGround() {
    var newGround = cc.instantiate(this.newGroundPrefab);
    newGround.x = 500;
    newGround.y = this.ground.y;
    this.node.addChild(newGround);
    var newRedPoint = this.spawnRedPoint();
    newGround.addChild(newRedPoint);
    newRedPoint.y = this.ground.height / 2 - newRedPoint.height / 2;
    var minWidthNewGround = 30;
    var maxWidthNewGround = 150;
    var newGroundPos = this.getNewGroundPosition(newGround.width);
    newGround.width = this.randomInteger(minWidthNewGround, maxWidthNewGround);
    this.playerDestination = newGroundPos.x + newGround.width / 2 - 20;
    var time = this.getTime(newGround.x - newGroundPos.x, 1000);
    cc.tween(newGround).to(time, {
      position: newGroundPos
    }).start();
    return newGround;
  },
  getNewGroundPosition: function getNewGroundPosition(newGroundWidth) {
    var groundY = this.ground.y;
    var minX = -(this.node.width / 2) + 150 + newGroundWidth / 2 + 5;
    var maxX = this.node.width / 2 - newGroundWidth / 2;
    var randX = this.randomInteger(minX, maxX);
    return cc.v2(randX, groundY);
  },
  start: function start() {},
  update: function update(dt) {}
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcR2FtZS5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIm5ld0dyb3VuZFByZWZhYiIsInR5cGUiLCJQcmVmYWIiLCJyZWRQb2ludFByZWZhYiIsInN0aWNrUHJlZmFiIiwiZ3JvdW5kIiwiTm9kZSIsInBsYXllciIsInNjb3JlRGlzcGxheSIsIkxhYmVsIiwicGxheWVyRGVzdGluYXRpb24iLCJpc01vdmluZyIsInRvdWNoU3RhcnQiLCJ0b3VjaEVuZCIsImNvbGxpc2lvbiIsInN0aWNrIiwibmV3R3JvdW5kIiwiYmV5b25kIiwic3RhcnRQb3NpdGlvbiIsIm9uTG9hZCIsInNwYXduU3RpY2siLCJzcGF3bk5ld0dyb3VuZCIsImdldENvbXBvbmVudCIsImdhbWUiLCJzY29yZSIsIm9uRW5hYmxlIiwibm9kZSIsIm9uY2UiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsIm9uVG91Y2hTdGFydCIsIlRPVUNIX0VORCIsIm9uVG91Y2hFbmQiLCJjYWxjdWxhdGVDb2xsaXNpb24iLCJzdWNjZXNzQWN0aW9uIiwiZmFpbEFjdGlvbiIsInNldFNjb3JlIiwic3RyaW5nIiwic3RhcnRDb2xsaXNpb25Qb2ludCIsIngiLCJ3aWR0aCIsImVuZENvbGxpc2lvblBvaW50Iiwic3RhcnRDb2xsaXNpb25SZWRQb2ludCIsImRhdGEiLCJlbmRDb2xsaXNpb25SZWRQb2ludCIsImRlc3RpbmF0aW9uIiwiaGVpZ2h0IiwiaXNDb2xsaXNpb24iLCJpc1BlcmZlY3QiLCJnZXRUaW1lIiwiZGlzdGFuY2UiLCJzcGVlZCIsInBsYXllck1vdmVUaW1lIiwic3RpY2tDb21lYmFja1RpbWUiLCJjb21lYmFja1RpbWUiLCJ0d2VlbiIsImRlbGF5IiwidG8iLCJhbmdsZSIsImNhbGwiLCJwb3NpdGlvbiIsInYyIiwieSIsInN0YXJ0IiwiZGVzdHJveSIsImFjdGl2ZSIsImJ5IiwiZGlyZWN0b3IiLCJsb2FkU2NlbmUiLCJyYW5kb21JbnRlZ2VyIiwibWluIiwibWF4IiwicmFuZCIsIk1hdGgiLCJyYW5kb20iLCJmbG9vciIsInNwYXduUmVkUG9pbnQiLCJpbnN0YW50aWF0ZSIsIm5ld1N0aWNrIiwiYWRkQ2hpbGQiLCJhbmNob3JZIiwibmV3UmVkUG9pbnQiLCJtaW5XaWR0aE5ld0dyb3VuZCIsIm1heFdpZHRoTmV3R3JvdW5kIiwibmV3R3JvdW5kUG9zIiwiZ2V0TmV3R3JvdW5kUG9zaXRpb24iLCJ0aW1lIiwibmV3R3JvdW5kV2lkdGgiLCJncm91bmRZIiwibWluWCIsIm1heFgiLCJyYW5kWCIsInVwZGF0ZSIsImR0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsZUFBZSxFQUFFO0FBQ2IsaUJBQVMsSUFESTtBQUViQyxNQUFBQSxJQUFJLEVBQUVMLEVBQUUsQ0FBQ007QUFGSSxLQURUO0FBTVJDLElBQUFBLGNBQWMsRUFBRTtBQUNaLGlCQUFTLElBREc7QUFFWkYsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNNO0FBRkcsS0FOUjtBQVdSRSxJQUFBQSxXQUFXLEVBQUU7QUFDVCxpQkFBUyxJQURBO0FBRVRILE1BQUFBLElBQUksRUFBRUwsRUFBRSxDQUFDTTtBQUZBLEtBWEw7QUFnQlJHLElBQUFBLE1BQU0sRUFBRTtBQUNKLGlCQUFTLElBREw7QUFFSkosTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNVO0FBRkwsS0FoQkE7QUFxQlJDLElBQUFBLE1BQU0sRUFBRTtBQUNKLGlCQUFTLElBREw7QUFFSk4sTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNVO0FBRkwsS0FyQkE7QUF5QlJFLElBQUFBLFlBQVksRUFBRTtBQUNWLGlCQUFTLElBREM7QUFFVlAsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNhO0FBRkMsS0F6Qk47QUE2QlJDLElB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QUEsUUFBUSxFQUFFd0I7QUFBWixLQUE3QixFQUF5RHJCLEtBQXpEO0FBQ0EsV0FBTy9DLFNBQVA7QUFDSCxHQWpNSTtBQW9NTHFFLEVBQUFBLG9CQXBNSyxnQ0FvTWdCRSxjQXBNaEIsRUFvTWdDO0FBQ2pDLFFBQU1DLE9BQU8sR0FBRyxLQUFLbkYsTUFBTCxDQUFZeUQsQ0FBNUI7QUFDQSxRQUFNMkIsSUFBSSxHQUFHLEVBQUUsS0FBSy9ELElBQUwsQ0FBVWMsS0FBVixHQUFrQixDQUFwQixJQUF5QixHQUF6QixHQUFnQytDLGNBQWMsR0FBRyxDQUFqRCxHQUFzRCxDQUFuRTtBQUNBLFFBQU1HLElBQUksR0FBSSxLQUFLaEUsSUFBTCxDQUFVYyxLQUFWLEdBQWtCLENBQW5CLEdBQXlCK0MsY0FBYyxHQUFHLENBQXZEO0FBQ0EsUUFBTUksS0FBSyxHQUFHLEtBQUt0QixhQUFMLENBQW1Cb0IsSUFBbkIsRUFBeUJDLElBQXpCLENBQWQ7QUFDQSxXQUFPOUYsRUFBRSxDQUFDaUUsRUFBSCxDQUFNOEIsS0FBTixFQUFhSCxPQUFiLENBQVA7QUFDSCxHQTFNSTtBQThNTHpCLEVBQUFBLEtBOU1LLG1CQThNRyxDQUVQLENBaE5JO0FBa05MNkIsRUFBQUEsTUFsTkssa0JBa05FQyxFQWxORixFQWtOTSxDQUVWO0FBcE5JLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgbmV3R3JvdW5kUHJlZmFiOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgICAgICAgIHR5cGU6IGNjLlByZWZhYlxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHJlZFBvaW50UHJlZmFiOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgICAgICAgIHR5cGU6IGNjLlByZWZhYlxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHN0aWNrUHJlZmFiOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgICAgICAgIHR5cGU6IGNjLlByZWZhYlxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGdyb3VuZDoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgcGxheWVyOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNjb3JlRGlzcGxheToge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICAgICAgICB0eXBlOiBjYy5MYWJlbFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcGxheWVyRGVzdGluYXRpb246ICdub25lJyxcclxuICAgICAgICBpc01vdmluZzogZmFsc2UsXHJcbiAgICAgICAgdG91Y2hTdGFydDogZmFsc2UsXHJcbiAgICAgICAgdG91Y2hFbmQ6IGZhbHNlLFxyXG4gICAgICAgIGNvbGxpc2lvbjogZmFsc2UsXHJcbiAgICAgICAgc3RpY2s6IG51bGwsXHJcbiAgICAgICAgbmV3R3JvdW5kOiBudWxsLFxyXG4gICAgICAgIGJleW9uZDogLTUwMCxcclxuICAgICAgICBzdGFydFBvc2l0aW9uOiAtMzAwLFxyXG4gICAgfSxcclxuXHJcbiAgICAvLyBMSUZFLUNZQ0xFIENBTExCQUNLUzpcclxuXHJcbiAgICBvbkxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5zdGljayA9IHRoaXMuc3Bhd25TdGljaygpO1xyXG4gICAgICAgIHRoaXMubmV3R3JvdW5kID0gdGhpcy5zcGF3bk5ld0dyb3VuZCgpO1xyXG4gICAgICAgIHRoaXMucGxheWVyLmdldENvbXBvbmVudCgnUGxheWVyJykuZ2FtZSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5zY29yZSA9IDA7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uRW5hYmxlKCkge1xyXG4gICAgICAgIHRoaXMubm9kZS5vbmNlKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJULCB0aGlzLm9uVG91Y2hTdGFydCwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uY2UoY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELCB0aGlzLm9uVG91Y2hFbmQsIHRoaXMpO1xyXG4gICAgfSxcclxuXHJcblxyXG4gICAgb25Ub3VjaFN0YXJ0KCkge1xyXG4gICAgICAgIHRoaXMudG91Y2hTdGFydCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy50b3VjaEVuZCA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcblxyXG4gICAgb25Ub3VjaEVuZCgpIHtcclxuICAgICAgICB0aGlzLnRvdWNoU3RhcnQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnRvdWNoRW5kID0gdHJ1ZTtcclxuICAgICAgICBpZiAodGhpcy5jYWxjdWxhdGVDb2xsaXNpb24oKSkge1xyXG4gICAgICAgICAgICB0aGlzLnN1Y2Nlc3NBY3Rpb24oKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmZhaWxBY3Rpb24oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSxcclxuXHJcbiAgICBzZXRTY29yZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuc2NvcmVEaXNwbGF5LnN0cmluZyA9ICdTY29yZTogJyArIHRoaXMuc2NvcmU7XHJcbiAgICB9LFxyXG5cclxuICAgIGNhbGN1bGF0ZUNvbGxpc2lvbigpIHtcclxuICAgICAgICBjb25zdCBzdGFydENvbGxpc2lvblBvaW50ID0gdGhpcy5uZXdHcm91bmQueCAtIHRoaXMubmV3R3JvdW5kLndpZHRoIC8gMjtcclxuICAgICAgICBjb25zdCBlbmRDb2xsaXNpb25Qb2ludCA9IHRoaXMubmV3R3JvdW5kLnggKyB0aGlzLm5ld0dyb3VuZC53aWR0aCAvIDI7XHJcbiAgICAgICAgY29uc3Qgc3RhcnRDb2xsaXNpb25SZWRQb2ludCA9IHRoaXMubmV3R3JvdW5kLnggLSB0aGlzLnJlZFBvaW50UHJlZmFiLmRhdGEud2lkdGggLyAyO1xyXG4gICAgICAgIGNvbnN0IGVuZENvbGxpc2lvblJlZFBvaW50ID0gdGhpcy5uZXdHcm91bmQueCArIHRoaXMucmVkUG9pbnRQcmVmYWIuZGF0YS53aWR0aCAvIDI7XHJcbiAgICAgICAgY29uc3QgZGVzdGluYXRpb24gPSB0aGlzLnN0aWNrLnggKyB0aGlzLnN0aWNrLmhlaWdodDtcclxuICAgICAgICBjb25zdCBpc0NvbGxpc2lvbiA9IGRlc3RpbmF0aW9uID49IHN0YXJ0Q29sbGlzaW9uUG9pbnQgJiYgZGVzdGluYXRpb24gPD0gZW5kQ29sbGlzaW9uUG9pbnQ7XHJcbiAgICAgICAgY29uc3QgaXNQZXJmZWN0ID0gZGVzdGluYXRpb24gPj0gc3RhcnRDb2xsaXNpb25SZWRQb2ludCAmJiBkZXN0aW5hdGlvbiA8PSBlbmRDb2xsaXNpb25SZWRQb2ludDtcclxuICAgICAgICBpZiAoaXNDb2xsaXNpb24gJiYgIWlzUGVyZmVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLnNjb3JlICs9IDE7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpc1BlcmZlY3QpIHtcclxuICAgICAgICAgICAgdGhpcy5zY29yZSArPSAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaXNDb2xsaXNpb247XHJcbiAgICB9LFxyXG5cclxuICAgIGdldFRpbWUoZGlzdGFuY2UsIHNwZWVkID0gNTAwKSB7XHJcbiAgICAgICAgcmV0dXJuIGRpc3RhbmNlIC8gc3BlZWQ7XHJcbiAgICB9LFxyXG5cclxuICAgIHN1Y2Nlc3NBY3Rpb24oKSB7XHJcbiAgICAgICAgY29uc3QgcGxheWVyTW92ZVRpbWUgPSB0aGlzLmdldFRpbWUodGhpcy5wbGF5ZXJEZXN0aW5hdGlvbiAtIHRoaXMucGxheWVyLngpO1xyXG4gICAgICAgIGNvbnN0IHN0aWNrQ29tZWJhY2tUaW1lID0gdGhpcy5nZXRUaW1lKCh0aGlzLm5ld0dyb3VuZC54IC0gdGhpcy5zdGljay54KSArIHRoaXMubmV3R3JvdW5kLndpZHRoIC8gMik7XHJcbiAgICAgICAgY29uc3QgY29tZWJhY2tUaW1lID0gdGhpcy5nZXRUaW1lKHRoaXMubmV3R3JvdW5kLnggLSB0aGlzLnN0YXJ0UG9zaXRpb24pO1xyXG4gICAgICAgIGNjLnR3ZWVuKHRoaXMuc3RpY2spLmRlbGF5KDAuMykudG8oMC40LCB7IGFuZ2xlOiAtOTAgfSlcclxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY2MudHdlZW4odGhpcy5wbGF5ZXIpLnRvKHBsYXllck1vdmVUaW1lLCB7IHBvc2l0aW9uOiBjYy52Mih0aGlzLnBsYXllckRlc3RpbmF0aW9uLCB0aGlzLnN0aWNrLnkpIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy50d2Vlbih0aGlzLm5ld0dyb3VuZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50byhjb21lYmFja1RpbWUsIHsgcG9zaXRpb246IGNjLnYyKHRoaXMuc3RhcnRQb3NpdGlvbiwgdGhpcy5ncm91bmQueSkgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdGFydCgpXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLnR3ZWVuKHRoaXMucGxheWVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRvKGNvbWViYWNrVGltZSwgeyBwb3NpdGlvbjogY2MudjIoKHRoaXMuc3RhcnRQb3NpdGlvbiArIHRoaXMubmV3R3JvdW5kLndpZHRoIC8gMikgLSAyMCwgdGhpcy5zdGljay55KSB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0YXJ0KClcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2MudHdlZW4odGhpcy5zdGljaylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50byhzdGlja0NvbWViYWNrVGltZSwgeyBwb3NpdGlvbjogY2MudjIodGhpcy5zdGljay54IC0gKHRoaXMubmV3R3JvdW5kLnggLSB0aGlzLnN0aWNrLnggKyB0aGlzLm5ld0dyb3VuZC53aWR0aCAvIDIpLCB0aGlzLnN0aWNrLnkpIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3RhcnQoKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy50d2Vlbih0aGlzLmdyb3VuZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50byhjb21lYmFja1RpbWUsIHsgcG9zaXRpb246IGNjLnYyKC04MDAsIHRoaXMuZ3JvdW5kLnkpIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB0aGlzLmdyb3VuZC5kZXN0cm95KCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB0aGlzLmdyb3VuZCA9IHRoaXMubmV3R3JvdW5kKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RpY2suYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGljayA9IHRoaXMuc3Bhd25TdGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV3R3JvdW5kID0gdGhpcy5zcGF3bk5ld0dyb3VuZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS5vbmNlKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJULCB0aGlzLm9uVG91Y2hTdGFydCwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ub2RlLm9uY2UoY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELCB0aGlzLm9uVG91Y2hFbmQsIHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdGFydCgpXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3RhcnQoKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB0aGlzLnNldFNjb3JlKCkpLnN0YXJ0KClcclxuICAgICAgICAgICAgLnN0YXJ0KCk7XHJcblxyXG4gICAgfSxcclxuXHJcbiAgICBmYWlsQWN0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHBsYXllck1vdmVUaW1lID0gdGhpcy5nZXRUaW1lKHRoaXMuc3RpY2suaGVpZ2h0KTtcclxuICAgICAgICBjYy50d2Vlbih0aGlzLnN0aWNrKS5kZWxheSgwLjMpLnRvKDAuNCwgeyBhbmdsZTogLTkwIH0pXHJcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNjLnR3ZWVuKHRoaXMucGxheWVyKS50byhwbGF5ZXJNb3ZlVGltZSwgeyBwb3NpdGlvbjogY2MudjIodGhpcy5wbGF5ZXIueCArIHRoaXMuc3RpY2suaGVpZ2h0LCB0aGlzLnN0aWNrLnkpIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4geyBjYy50d2Vlbih0aGlzLnN0aWNrKS50bygwLjQsIHsgYW5nbGU6IC0xODAgfSkuc3RhcnQoKSB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2MudHdlZW4odGhpcy5wbGF5ZXIpLmJ5KDAuMywgeyBwb3NpdGlvbjogY2MudjIoMCwgLTM1MCkgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kZWxheSgxKS5jYWxsKCgpID0+IGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnZ2FtZScpKS5zdGFydCgpXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLnN0YXJ0KClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXJ0KCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHJhbmRvbUludGVnZXIobWluLCBtYXgpIHtcclxuICAgICAgICBjb25zdCByYW5kID0gbWluICsgTWF0aC5yYW5kb20oKSAqIChtYXggKyAxIC0gbWluKTtcclxuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihyYW5kKTtcclxuICAgIH0sXHJcblxyXG4gICAgc3Bhd25SZWRQb2ludCgpIHtcclxuICAgICAgICByZXR1cm4gY2MuaW5zdGFudGlhdGUodGhpcy5yZWRQb2ludFByZWZhYik7XHJcbiAgICB9LFxyXG5cclxuICAgIHNwYXduU3RpY2soKSB7XHJcbiAgICAgICAgY29uc3QgbmV3U3RpY2sgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLnN0aWNrUHJlZmFiKTtcclxuICAgICAgICB0aGlzLm5vZGUuYWRkQ2hpbGQobmV3U3RpY2spO1xyXG4gICAgICAgIG5ld1N0aWNrLmFuY2hvclkgPSAwO1xyXG4gICAgICAgIG5ld1N0aWNrLnkgPSB0aGlzLmdyb3VuZC55ICsgdGhpcy5ncm91bmQuaGVpZ2h0IC8gMjtcclxuICAgICAgICBuZXdTdGljay54ID0gdGhpcy5zdGFydFBvc2l0aW9uICsgdGhpcy5ncm91bmQud2lkdGggLyAyO1xyXG4gICAgICAgIG5ld1N0aWNrLmdldENvbXBvbmVudCgnU3RpY2snKS5nYW1lID0gdGhpcztcclxuICAgICAgICByZXR1cm4gbmV3U3RpY2s7XHJcbiAgICB9LFxyXG5cclxuICAgIHNwYXduTmV3R3JvdW5kKCkge1xyXG4gICAgICAgIGNvbnN0IG5ld0dyb3VuZCA9IGNjLmluc3RhbnRpYXRlKHRoaXMubmV3R3JvdW5kUHJlZmFiKTtcclxuICAgICAgICBuZXdHcm91bmQueCA9IDUwMDtcclxuICAgICAgICBuZXdHcm91bmQueSA9IHRoaXMuZ3JvdW5kLnk7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFkZENoaWxkKG5ld0dyb3VuZCk7XHJcbiAgICAgICAgY29uc3QgbmV3UmVkUG9pbnQgPSB0aGlzLnNwYXduUmVkUG9pbnQoKTtcclxuICAgICAgICBuZXdHcm91bmQuYWRkQ2hpbGQobmV3UmVkUG9pbnQpO1xyXG4gICAgICAgIG5ld1JlZFBvaW50LnkgPSB0aGlzLmdyb3VuZC5oZWlnaHQgLyAyIC0gbmV3UmVkUG9pbnQuaGVpZ2h0IC8gMjtcclxuICAgICAgICBjb25zdCBtaW5XaWR0aE5ld0dyb3VuZCA9IDMwO1xyXG4gICAgICAgIGNvbnN0IG1heFdpZHRoTmV3R3JvdW5kID0gMTUwO1xyXG4gICAgICAgIGNvbnN0IG5ld0dyb3VuZFBvcyA9IHRoaXMuZ2V0TmV3R3JvdW5kUG9zaXRpb24obmV3R3JvdW5kLndpZHRoKTtcclxuICAgICAgICBuZXdHcm91bmQud2lkdGggPSB0aGlzLnJhbmRvbUludGVnZXIobWluV2lkdGhOZXdHcm91bmQsIG1heFdpZHRoTmV3R3JvdW5kKTtcclxuICAgICAgICB0aGlzLnBsYXllckRlc3RpbmF0aW9uID0gKG5ld0dyb3VuZFBvcy54ICsgbmV3R3JvdW5kLndpZHRoIC8gMikgLSAyMDtcclxuICAgICAgICBjb25zdCB0aW1lID0gdGhpcy5nZXRUaW1lKG5ld0dyb3VuZC54IC0gbmV3R3JvdW5kUG9zLngsIDEwMDApO1xyXG4gICAgICAgIGNjLnR3ZWVuKG5ld0dyb3VuZCkudG8odGltZSwgeyBwb3NpdGlvbjogbmV3R3JvdW5kUG9zIH0pLnN0YXJ0KClcclxuICAgICAgICByZXR1cm4gbmV3R3JvdW5kO1xyXG4gICAgfSxcclxuXHJcblxyXG4gICAgZ2V0TmV3R3JvdW5kUG9zaXRpb24obmV3R3JvdW5kV2lkdGgpIHtcclxuICAgICAgICBjb25zdCBncm91bmRZID0gdGhpcy5ncm91bmQueTtcclxuICAgICAgICBjb25zdCBtaW5YID0gLSh0aGlzLm5vZGUud2lkdGggLyAyKSArIDE1MCArIChuZXdHcm91bmRXaWR0aCAvIDIpICsgNTtcclxuICAgICAgICBjb25zdCBtYXhYID0gKHRoaXMubm9kZS53aWR0aCAvIDIpIC0gKG5ld0dyb3VuZFdpZHRoIC8gMik7XHJcbiAgICAgICAgY29uc3QgcmFuZFggPSB0aGlzLnJhbmRvbUludGVnZXIobWluWCwgbWF4WCk7XHJcbiAgICAgICAgcmV0dXJuIGNjLnYyKHJhbmRYLCBncm91bmRZKTtcclxuICAgIH0sXHJcblxyXG5cclxuXHJcbiAgICBzdGFydCgpIHtcclxuXHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZShkdCkge1xyXG5cclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=